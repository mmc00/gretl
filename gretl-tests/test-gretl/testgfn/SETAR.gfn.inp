include ./SETAR.gfn
#================================================================
#   SETAR fucntion for gretl by Federico Lampis
#   Carlos III University of Madrid, Spain
#   flampis@emp.uc3m.es
#================================================================
#
# CONTROL PARAMETERS (can be modified if desired!)
#  scalar conf1=.95   			# Confidence Level for Confidence Regions
#  scalar conf2=.8   	 		# Confidence Level for first step of two-step
#  scalar trim=0.15             # Percentage of sample to trim from ends for test,
#  scalar rep=1000              # Number of bootstrap replications for linearity test
#  
#============================================================== 
#
#			FUNCTION ARGUMENTS 
# VARIABLE              = Dependent variable of the SETAR model.
#
# AUTOREGRESSIVE ORDER  = Autoregressive order of the SETAR model, the 2 regimes have the same order.
#
# DELAY    		        = Delay of the Threshold Parameter Y_(t-d), fixing this parameter you are choosing 
#              		      which lag of the Dependent variable you want to use to estimate the model.
#
# LAGS INCLUDED         = Lags of dependent variable included in the SETAR estimation; if this box is empty 
#				          all the lags from 1 to p are included, otherwise you must specify which lags include,
#                         e.g. writing {1, 3, 5} you include the lags 1,3,5 of dependent variable. 	
#
# HETEROSKEDASTICITY
# CORRECTION            = The SETAR model is estimated under the hypothesis the error term is a Martingale Difference and 
#                         the confidence intervals are computed with the white heteroskedasticity correction. Otherwise  
#                         the hypotesis of homoskedasticity is assumed and e_t is iid(0, sigma^2). 
#
# LINEARITY TEST        = Marking this box a linearity test under the null hypothesis of none threshold in the the
#					      autoregressive model is performed. The number of replication is 1000. In case the box 
#                         "Heteroskedasticity correction" is marked the test if carried assuming heteroskedasticity 
#  					      error term.	
#     

# the data used by Tong can be found at http://eom.springer.de/c/c110040.htm
open http://ricardo.ecn.wfu.edu/pub/gretldata/lynx.gdt
series y=log10(lynx)

#OPTION A
# Estimation of SETAR model with p=2 and d=2. All lags are included in the estimation,  
# the hypothesis of homoskedasticity is assumed and the linear test is NOT performed.
example = SETAR(y, 2, 2, null, 0, 0)

#OPTION B
# Estimation of SETAR model with p=2 and d=2. All lags are included in the estimation,  
# the hypothesis of heteroskedasticity is assumed and the linear test is NOT performed.
example = SETAR(y, 2, 2, null, 1, 0)

#OPTION C
# Estimation of SETAR model with p=2 and d=2. All lags are included in the estimation,  
# the hypothesis of homoskedasticity is assumed and the linear test is performed.
example = SETAR(y, 2, 2, null, 0, 1)

#OPTION D
# Estimation of SETAR model with p=2 and d=2. All lags are included in the estimation,  
# the hypothesis of heteroskedasticity is assumed and the linear test is performed. 
example = SETAR(y, 2, 2, null, 1, 1)

#If you want estimate the SETAR model using not all the lags from 1 to p, create a
# matrix with the lags you want to include:
matrix included={2}

#After that the estimation is performed as before for the options A, B, C, D. 
#E.g. for the case C execute this command: 
example = SETAR(y, 2, 2, &included, 0, 1)